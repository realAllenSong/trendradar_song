services:
  trendradar:
    image: wantcat/trendradar:latest
    container_name: trendradar
    restart: unless-stopped

    ports:
      - "127.0.0.1:${WEBSERVER_PORT:-8080}:${WEBSERVER_PORT:-8080}"

    volumes:
      - ../config:/app/config:ro
      - ../output:/app/output
      - ../models:/app/models
      - ../audio:/app/audio

    environment:
      - TZ=Asia/Shanghai
      # 核心配置
      - ENABLE_CRAWLER=${ENABLE_CRAWLER:-}
      - ENABLE_NOTIFICATION=${ENABLE_NOTIFICATION:-}
      - REPORT_MODE=${REPORT_MODE:-}
      - DISPLAY_MODE=${DISPLAY_MODE:-}
      # 音频播报
      - AUDIO_ENABLED=${AUDIO_ENABLED:-}
      - AUDIO_INTERVAL_HOURS=${AUDIO_INTERVAL_HOURS:-}
      - AUDIO_FETCH_TIMEOUT_SECONDS=${AUDIO_FETCH_TIMEOUT_SECONDS:-}
      - AUDIO_FETCH_MAX_BYTES=${AUDIO_FETCH_MAX_BYTES:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GEMINI_MODEL=${GEMINI_MODEL:-}
      - INDEXTTS_PROVIDER=${INDEXTTS_PROVIDER:-}
      - INDEXTTS_ENDPOINT=${INDEXTTS_ENDPOINT:-}
      - INDEXTTS_API_KEY=${INDEXTTS_API_KEY:-}
      - INDEXTTS_VOICE=${INDEXTTS_VOICE:-}
      - INDEXTTS_FORMAT=${INDEXTTS_FORMAT:-}
      - AUTO_DOWNLOAD_VOXCPM_ONNX=${AUTO_DOWNLOAD_VOXCPM_ONNX:-true}
      - AUTO_DOWNLOAD_VOXCPM_MODEL=${AUTO_DOWNLOAD_VOXCPM_MODEL:-true}
      - VOXCPM_REPO_DIR=${VOXCPM_REPO_DIR:-}
      - VOXCPM_INFER_PATH=${VOXCPM_INFER_PATH:-}
      - VOXCPM_MODELS_DIR=${VOXCPM_MODELS_DIR:-}
      - VOXCPM_VOXCPM_DIR=${VOXCPM_VOXCPM_DIR:-}
      - VOXCPM_VOICES_FILE=${VOXCPM_VOICES_FILE:-}
      - VOXCPM_VOICE=${VOXCPM_VOICE:-}
      - VOXCPM_BATCH_MODE=${VOXCPM_BATCH_MODE:-}
      - VOXCPM_MAX_THREADS=${VOXCPM_MAX_THREADS:-}
      - VOXCPM_TEXT_NORMALIZER=${VOXCPM_TEXT_NORMALIZER:-}
      - VOXCPM_AUDIO_NORMALIZER=${VOXCPM_AUDIO_NORMALIZER:-}
      - VOXCPM_CFG_VALUE=${VOXCPM_CFG_VALUE:-}
      - VOXCPM_FIXED_TIMESTEPS=${VOXCPM_FIXED_TIMESTEPS:-}
      - VOXCPM_SEED=${VOXCPM_SEED:-}
      - VOXCPM_ONNX_REPO=${VOXCPM_ONNX_REPO:-}
      - VOXCPM_ONNX_URL=${VOXCPM_ONNX_URL:-}
      - VOXCPM_ONNX_REVISION=${VOXCPM_ONNX_REVISION:-}
      - VOXCPM_ONNX_FORCE=${VOXCPM_ONNX_FORCE:-}
      - VOXCPM_MODEL_REPO=${VOXCPM_MODEL_REPO:-}
      - VOXCPM_REPO_URL=${VOXCPM_REPO_URL:-}
      - SHERPA_ONNX_MODEL_DIR=${SHERPA_ONNX_MODEL_DIR:-}
      - SHERPA_ONNX_ACOUSTIC_MODEL=${SHERPA_ONNX_ACOUSTIC_MODEL:-}
      - SHERPA_ONNX_VOCODER=${SHERPA_ONNX_VOCODER:-}
      - SHERPA_ONNX_TOKENS=${SHERPA_ONNX_TOKENS:-}
      - SHERPA_ONNX_LEXICON=${SHERPA_ONNX_LEXICON:-}
      - SHERPA_ONNX_RULE_FSTS=${SHERPA_ONNX_RULE_FSTS:-}
      - SHERPA_ONNX_DATA_DIR=${SHERPA_ONNX_DATA_DIR:-}
      - SHERPA_ONNX_SID=${SHERPA_ONNX_SID:-}
      - SHERPA_ONNX_SPEED=${SHERPA_ONNX_SPEED:-}
      - SHERPA_ONNX_NUM_THREADS=${SHERPA_ONNX_NUM_THREADS:-}
      - SHERPA_ONNX_PROVIDER=${SHERPA_ONNX_PROVIDER:-}
      - SHERPA_ONNX_MAX_NUM_SENTENCES=${SHERPA_ONNX_MAX_NUM_SENTENCES:-}
      # Web 服务器
      - ENABLE_WEBSERVER=${ENABLE_WEBSERVER:-false}
      - WEBSERVER_PORT=${WEBSERVER_PORT:-8080}
      # 通知渠道
      - FEISHU_WEBHOOK_URL=${FEISHU_WEBHOOK_URL:-}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
      - DINGTALK_WEBHOOK_URL=${DINGTALK_WEBHOOK_URL:-}
      - WEWORK_WEBHOOK_URL=${WEWORK_WEBHOOK_URL:-}
      - WEWORK_MSG_TYPE=${WEWORK_MSG_TYPE:-}
      # 邮件配置
      - EMAIL_FROM=${EMAIL_FROM:-}
      - EMAIL_PASSWORD=${EMAIL_PASSWORD:-}
      - EMAIL_TO=${EMAIL_TO:-}
      - EMAIL_SMTP_SERVER=${EMAIL_SMTP_SERVER:-}
      - EMAIL_SMTP_PORT=${EMAIL_SMTP_PORT:-}
      # ntfy配置
      - NTFY_SERVER_URL=${NTFY_SERVER_URL:-https://ntfy.sh}
      - NTFY_TOPIC=${NTFY_TOPIC:-}
      - NTFY_TOKEN=${NTFY_TOKEN:-}
      # Bark配置
      - BARK_URL=${BARK_URL:-}
      # Slack配置
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL:-}
      # 远程存储配置（S3 兼容协议）
      - S3_ENDPOINT_URL=${S3_ENDPOINT_URL:-}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME:-}
      - S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID:-}
      - S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY:-}
      - S3_REGION=${S3_REGION:-}
      # 运行模式
      - CRON_SCHEDULE=${CRON_SCHEDULE:-*/30 * * * *}
      - RUN_MODE=${RUN_MODE:-cron}
      - IMMEDIATE_RUN=${IMMEDIATE_RUN:-true}

  trendradar-mcp:
    image: wantcat/trendradar-mcp:latest
    container_name: trendradar-mcp
    restart: unless-stopped

    ports:
      - "127.0.0.1:3333:3333"

    volumes:
      - ../config:/app/config:ro
      - ../output:/app/output

    environment:
      - TZ=Asia/Shanghai
